---
title: "Método Montecarlo para el análisis de riesgo en el análisis coste-beneficio"
author: "Saul Torres-Ortega"
date: "Monday, June 01, 2015"
output: pdf_document
---
#Enunciado
Un determinado proyecto de inversión pública necesita ser evaluado para analizar la posibilidad de que sea llevado o no a cabo.

El proyecto presenta los siguientes costes e ingresos:
\begin{itemize}
  \item Un coste C1 (de inversión). Un total de 8.000.000 u.m. repartidas en los tres primeros años del proyecto.
  \item Un coste C2 (de explotación). 250.000 u.m. a partir de la puesta en marcha del proyecto con una tasa de crecimiento del 2%.
  \item Un coste C3 (efecto pernicioso). 75.000 u.m. a partir de la puesta en marcha del proyecto con una tasa de crecimiento del 2%.
  \item Un ingreso I1. Se experimenta a partir del año 2, con un valor de 250.000 u.m. y una tasa de crecimiento del 3,5%.
  \item Un ingreso I2. 400.000 u.m. a partir de la puesta en marcha del proyecto con una tasa de crecimiento del 2,5%.
  \item Un ingreso I3. 350.000 u.m. a partir de la puesta en marcha del proyecto con una tasa de crecimiento del 3%.
\end{itemize}

Se plantea la necesidad de \textbf{evaluar el proyecto} presentado con un horizonte de 10 años y utilizando una tasa de descuento del 3,5% anual.

Sin embargo, todos los datos que se poseen acerca del proyecto presentan una gran incertidumbre, por lo que un \textbf{análisis de riesgo} de los mismos es necesario.

Los intervalos de variación de los datos son los que se presentan a continuación. 
\begin{tabular}{|c|c|c|c|c|c|c|}
  \hline  & Tasa de descuento & I1 & I2 & I3 & C2 & C3 \\ 
	\hline Mínimo & 0,025 & 200 & 300 & 300 & -200 & -70 \\ 
	\hline Máximo & 0,035 & 300 & 500 & 500 & -300 & -90 \\ 
	\hline  &  &  &  &  &  &  \\ 
	\hline  & CRECIMIENTOS & I1 & I2 & I3 & C2 & C3 \\ 
	\hline Mínimo &  & 0,03 & 0,02 & 0,03 & 0,015 & -0,02 \\ 
	\hline Máximo &  & 0,04 & 0,035 & 0,03 & 0,03 & 0,04 \\ 
	\hline 
\end{tabular} 
\pagebreak

#Solución
Calculamos el caso base que nos plantean.

```{r}
#Crear serie de años
vector_años = 2015:2024
Años = ts(vector_años, start=c(2015), end=c(2024), frequency=1) 
Años

#Crear vectores de costes
C1 = c(1000000, 5000000, 2000000, 0, 0, 0, 0, 0, 0, 0)

crecC2 = 0.02
InicC2 = 250000
C2 = c(0, 0, 0, InicC2, InicC2*(1+crecC2), InicC2*(1+crecC2)^2, InicC2*(1+crecC2)^3, InicC2*(1+crecC2)^4, InicC2*(1+crecC2)^5, InicC2*(1+crecC2)^6)

crecC3 = 0.02
InicC3 = 75000
C3 = c(0, 0, 0, InicC3, InicC3*(1+crecC3), InicC3*(1+crecC3)^2, InicC3*(1+crecC3)^3, InicC3*(1+crecC3)^4, InicC3*(1+crecC3)^5, InicC3*(1+crecC3)^6)

#Crear vectores de ingresos
crecI1 = 0.035
InicI1 = 250000
I1 = c(0, InicI1, InicI1*(1+crecI1), InicI1*(1+crecI1)^2, InicI1*(1+crecI1)^3, InicI1*(1+crecI1)^4, InicI1*(1+crecI1)^5, InicI1*(1+crecI1)^6, InicI1*(1+crecI1)^7, InicI1*(1+crecI1)^8)

crecI2 = 0.025
InicI2 = 400000
I2 = c(0, 0, 0, InicI2, InicI2*(1+crecI2), InicI2*(1+crecI2)^2, InicI2*(1+crecI2)^3, InicI2*(1+crecI2)^4, InicI2*(1+crecI2)^5, InicI2*(1+crecI2)^6)

crecI3 = 0.03
InicI3 = 350000
I3 = c(0, 0, 0, InicI3, InicI3*(1+crecI3), InicI3*(1+crecI3)^2, InicI3*(1+crecI3)^3, InicI3*(1+crecI3)^4, InicI3*(1+crecI3)^5, InicI3*(1+crecI3)^6)


#Beneficios
Benefit = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
for (i in 1:10)
  Benefit[i] = (I1[i]+I2[i]+I3[i])-(C1[i]+C2[i]+C3[i])

#Valores actualizados
tasaDesc = 0.035
VA = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
for (i in 1:10)
  VA[i] = Benefit[i]/((1+tasaDesc)^(i))

#Creamos DataFrame
ACB = data.frame(Años, I1, I2, I3, C1, C2, C3, Benefit, VA)
ACB

#Valor Actualizado Neto
VAN = sum (VA)
VAN
```

```{r, echo=FALSE}
plot (Benefit, type="h")

```


\pagebreak

Ahora hacemos la simulación de MonteCarlo.

Primero generamos un caso aleatorio.
```{r}
#Generamos de nuevo todas las variables pero ahora en función de un valor aleatorio
Alea_C1 = c(1000000, 5000000, 2000000, 0, 0, 0, 0, 0, 0, 0)

Alea_InicC2 = runif(1, 200000, 300000)
Alea_crecC2 = runif(1, 0.015, 0.03)
Alea_C2 = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
for (j in 4:10){
  Alea_C2[j] = Alea_InicC2*((1+Alea_crecC2)^(j-4))
  }
  
Alea_InicC3 = runif(1, 70000, 90000)
Alea_crecC3 = runif(1, -0.02, 0.04)
Alea_C3 = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
for (j in 4:10) {
  Alea_C3[j] = Alea_InicC3*((1+Alea_crecC3)^(j-4))
  }

Alea_InicI1 = runif(1, 200000, 300000)
Alea_crecI1 = runif(1, 0.03, 0.04)
Alea_I1 = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
for (j in 2:10) {
  Alea_I1[j] = Alea_InicI1*((1+Alea_crecI1)^(j-2))
  }

Alea_InicI2 = runif(1, 300000, 500000)
Alea_crecI2 = runif(1, 0.02, 0.035)
Alea_I2 = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
for (i in 4:10) {
  Alea_I2[j] = Alea_InicI2*((1+Alea_crecI2)^(j-4))
  }

Alea_InicI3 = runif(1, 300000, 500000)
Alea_crecI3 = 0.03
Alea_I3 = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
for (i in 4:10) {
  Alea_I3[j] = Alea_InicI3*((1+Alea_crecI3)^(j-4))
  }

Alea_Benefit = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
for (i in 1:10) {
  Alea_Benefit[j] = (Alea_I1[j]+Alea_I2[j]+Alea_I3[j])-(Alea_C1[j]+Alea_C2[j]+Alea_C3[j])
  }

Alea_tasaDesc = runif(1, 0.025, 0.035)
Alea_VA = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
for (j in 1:10) {
  Alea_VA[j] = Alea_Benefit[j]/((1+Alea_tasaDesc)^(j))
  }

Alea_VAN = sum (Alea_VA)
```

Ahora generamos las iteraciones que consideremos necesarias y almacenamos el valor del VAN en un nuevo vector.
```{r}
#Realizamos 100 casos
vector_años = 2015:2024
Años = ts(vector_años, start=c(2015), end=c(2024), frequency=1) 
VAN_MC = c(1:100)
for (i in 1:100) {
  Alea_C1 = c(1000000, 5000000, 2000000, 0, 0, 0, 0, 0, 0, 0)

  Alea_InicC2 = runif(1, 200000, 300000)
  Alea_crecC2 = runif(1, 0.015, 0.03)
  Alea_C2 = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
  for (j in 4:10){
    Alea_C2[j] = Alea_InicC2*((1+Alea_crecC2)^(j-4))
    }
  
  Alea_InicC3 = runif(1, 70000, 90000)
  Alea_crecC3 = runif(1, -0.02, 0.04)
  Alea_C3 = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
  for (j in 4:10) {
    Alea_C3[j] = Alea_InicC3*((1+Alea_crecC3)^(j-4))
    }

  Alea_InicI1 = runif(1, 200000, 300000)
  Alea_crecI1 = runif(1, 0.03, 0.04)
  Alea_I1 = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
  for (j in 2:10) {
    Alea_I1[j] = Alea_InicI1*((1+Alea_crecI1)^(j-2))
    }

  Alea_InicI2 = runif(1, 300000, 500000)
  Alea_crecI2 = runif(1, 0.02, 0.035)
  Alea_I2 = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
  for (j in 4:10) {
    Alea_I2[j] = Alea_InicI2*((1+Alea_crecI2)^(j-4))
    }

  Alea_InicI3 = runif(1, 300000, 500000)
  Alea_crecI3 = 0.03
  Alea_I3 = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
  for (j in 4:10) {
    Alea_I3[j] = Alea_InicI3*((1+Alea_crecI3)^(j-4))
    }

  Alea_Benefit = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
  for (j in 1:10) {
    Alea_Benefit[j] = (Alea_I1[j]+Alea_I2[j]+Alea_I3[j])-(Alea_C1[j]+Alea_C2[j]+Alea_C3[j])
    }

  Alea_tasaDesc = runif(1, 0.025, 0.035)
  Alea_VA = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
  for (j in 1:10) {
    Alea_VA[j] = Alea_Benefit[j]/((1+Alea_tasaDesc)^(j))
    }

  ACB = data.frame(Años, Alea_I1, Alea_I2, Alea_I3, Alea_C1, Alea_C2, Alea_C3, Alea_Benefit, Alea_VA)
  ACB
  Alea_VAN = sum (Alea_VA)
  VAN_MC[i] = Alea_VAN
}
VAN_MC
```

Ahora nos interesa tratar estadísticamente esos valores generados.
```{r}
Media_MC = mean (VAN_MC)
Varianza_MC = var (VAN_MC)
hist (VAN_MC)
plot(density(VAN_MC))

VAN_MC_ordenado = sort(VAN_MC, decreasing=FALSE)
plot (VAN_MC_ordenado, main="Probabilidad de VAN", xlab="Probabilidad acumulada", ylab="VAN en u.m.", type="l")
```
